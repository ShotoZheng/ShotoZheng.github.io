<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 3.9.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.0"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.4.0"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.4.0"><link rel="mask-icon" href="/images/logo.svg?v=7.4.0" color="#222"><link rel="stylesheet" href="/css/main.css?v=7.4.0"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0"><link rel="stylesheet" href="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="/lib/pace/pace-theme-flash.min.css?v=1.0.2"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Pisces",version:"7.4.0",exturl:!1,sidebar:{position:"left",display:"post",offset:12,onmobile:!1},copycode:{enable:!0,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!1,pangu:!1,algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},translation:{copy_button:"复制",copy_success:"复制成功",copy_failure:"复制失败"},sidebarPadding:40}</script><meta name="description" content="1. Java NIO 简介 Java NIO（New IO） 是从Java 1.4版本开始引入的一个新的IO API，可以替代标准的Java IO API。NIO与原来的IO有同样的作用和目的，但是使用的方式完全不同， NIO支持面向缓冲区（Buffer）的、基于通道（Channel）的IO操作。 NIO能以更加高效的方式进行文件的读写操作，并且是非阻塞IO。"><meta name="keywords" content="Java"><meta property="og:type" content="article"><meta property="og:title" content="（一）NIO - Buffer"><meta property="og:url" content="https://ShotoZheng.github.io/2020/01/05/（一）NIO-Buffer/index.html"><meta property="og:site_name" content="鱼肚白不是鱼"><meta property="og:description" content="1. Java NIO 简介 Java NIO（New IO） 是从Java 1.4版本开始引入的一个新的IO API，可以替代标准的Java IO API。NIO与原来的IO有同样的作用和目的，但是使用的方式完全不同， NIO支持面向缓冲区（Buffer）的、基于通道（Channel）的IO操作。 NIO能以更加高效的方式进行文件的读写操作，并且是非阻塞IO。"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://shotozheng.github.io/2020/01/05/（一）NIO-Buffer/20190331113626214.png"><meta property="og:image" content="https://shotozheng.github.io/2020/01/05/（一）NIO-Buffer/2019033111473055.png"><meta property="og:image" content="https://shotozheng.github.io/2020/01/05/（一）NIO-Buffer/20190331150902388.png"><meta property="og:image" content="https://shotozheng.github.io/2020/01/05/（一）NIO-Buffer/20190331151008853.png"><meta property="og:image" content="https://shotozheng.github.io/2020/01/05/（一）NIO-Buffer/20190331151638820.png"><meta property="og:image" content="https://shotozheng.github.io/2020/01/05/（一）NIO-Buffer/2019033115192997.png"><meta property="og:image" content="https://shotozheng.github.io/2020/01/05/（一）NIO-Buffer/20190331152202880.png"><meta property="og:image" content="https://shotozheng.github.io/2020/01/05/（一）NIO-Buffer/20190331154157596.png"><meta property="og:image" content="https://shotozheng.github.io/2020/01/05/（一）NIO-Buffer/20190331160053865.png"><meta property="og:updated_time" content="2020-01-05T01:15:14.047Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="（一）NIO - Buffer"><meta name="twitter:description" content="1. Java NIO 简介 Java NIO（New IO） 是从Java 1.4版本开始引入的一个新的IO API，可以替代标准的Java IO API。NIO与原来的IO有同样的作用和目的，但是使用的方式完全不同， NIO支持面向缓冲区（Buffer）的、基于通道（Channel）的IO操作。 NIO能以更加高效的方式进行文件的读写操作，并且是非阻塞IO。"><meta name="twitter:image" content="https://shotozheng.github.io/2020/01/05/（一）NIO-Buffer/20190331113626214.png"><link rel="canonical" href="https://ShotoZheng.github.io/2020/01/05/（一）NIO-Buffer/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,isPage:!1,isArchive:!1}</script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/theme-next/theme-next-needmoreshare2@1/needsharebutton.min.css"><style>#needsharebutton-postbottom{cursor:pointer;height:26px;margin-top:10px;position:relative}#needsharebutton-postbottom .btn{border:1px solid $btn-default-border-color;border-radius:3px;display:initial;padding:1px 4px}</style><title>（一）NIO - Buffer | 鱼肚白不是鱼</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN"><link rel="stylesheet" href="/dist/APlayer.min.css"><div id="aplayer"></div><script type="text/javascript" src="/dist/APlayer.min.js"></script><script type="text/javascript" src="/dist/music.js"></script><div class="container use-motion"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">鱼肚白不是鱼</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">笨鸟先飞</p></div><div class="site-nav-toggle"><button aria-label="切换导航栏"><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-随笔"><a href="/随笔/" rel="section"><i class="menu-item-icon fa fa-fw fa-calendar"></i><br>随笔</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article itemscope itemtype="http://schema.org/Article"><div class="post-block post"><link itemprop="mainEntityOfPage" href="https://ShotoZheng.github.io/2020/01/05/（一）NIO-Buffer/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="郑松涛"><meta itemprop="description" content="积跬步，至千里"><meta itemprop="image" content="/images/kanieki.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="鱼肚白不是鱼"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">（一）NIO - Buffer</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-01-05 09:10:47 / 修改时间：09:15:14" itemprop="dateCreated datePublished" datetime="2020-01-05T09:10:47+08:00">2020-01-05</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Java/NIO/" itemprop="url" rel="index"><span itemprop="name">NIO</span></a></span> </span><span class="post-meta-item" title="阅读次数"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span class="busuanzi-value" id="busuanzi_value_page_pv"></span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><span class="post-meta-item-text">Valine：</span> <a title="valine" href="/2020/01/05/（一）NIO-Buffer/#comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2020/01/05/（一）NIO-Buffer/" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>5.1k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>5 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="1-Java-NIO-简介"><a href="#1-Java-NIO-简介" class="headerlink" title="1. Java NIO 简介"></a>1. Java NIO 简介</h1><p>Java NIO（New IO） 是从Java 1.4版本开始引入的一个新的IO API，可以替代标准的Java IO API。NIO与原来的IO有同样的作用和目的，但是使用的方式完全不同， <strong>NIO支持面向缓冲区（Buffer）的、基于通道（Channel）的IO操作。</strong> NIO能以更加高效的方式进行文件的读写操作，并且是<strong>非阻塞IO</strong>。</p><a id="more"></a><p>使用NIO进行数据的读取时，会将文件/网络/磁盘中的数据放入缓冲区中，然后通过通道进行传输，之后再通过程序代码进行数据的其他操作。当使用 NIO进行数据的写入时，通过程序代码将数据存放到缓冲区中，然后再经过通道传输并将缓冲区的数据存储到文件或者进行其他操作。简而言之， Channel 负责传输， Buffer 负责存储。大致流程如下图所示：<br><img src="/2020/01/05/（一）NIO-Buffer/20190331113626214.png" alt="在这里插入图片描述"><br>对于传统的IO，其是<strong>面向流</strong>的。传统的输入输出流都是通过字节的移动来处理的（即使不直接去处理字节流，但底层的实现还是依赖于字节处理），也就是说，面向流的输入/输出系统一次只能处理一个字节，因此面向流的输入/输出系统通常效率不高。另外，<strong>传统的IO是阻塞式IO</strong>。其数据传输的大致流程如下图所示：<br><img src="/2020/01/05/（一）NIO-Buffer/2019033111473055.png" alt="在这里插入图片描述"></p><h1 id="2-使用-Buffer"><a href="#2-使用-Buffer" class="headerlink" title="2. 使用 Buffer"></a>2. 使用 Buffer</h1><p>缓冲区（Buffer） ：一个用于特定基本数据类型的容器。由 java.nio 包定义的，所有缓冲区都是 Buffer 抽象类的子类。</p><p>Java NIO 中的 Buffer 主要用于与 NIO 通道进行交互，数据是从通道读入缓冲区，从缓冲区写入通道中的。Buffer 就像一个数组，可以保存多个相同类型的数据。根据数据类型不同(boolean 除外) ，有以下 Buffer 常用子类：</p><p>ByteBuffer、CharBuffer、ShortBuffer、IntBuffer、LongBuffer、FloatBuffer 和 DoubleBuffer。</p><p>上述 Buffer 类他们都采用相似的方法进行管理数据，只是各自管理的数据类型不同而已，都是通如下方法获取一个 Buffer对象：</p><p>static XxxBuffer allocate(int capacity) : 创建一个容量为 capacity 的 XxxBuffer 对象。</p><h2 id="2-1-Buffer-中的重要概念"><a href="#2-1-Buffer-中的重要概念" class="headerlink" title="2.1 Buffer 中的重要概念"></a>2.1 Buffer 中的重要概念</h2><ul><li><strong>容量 (capacity)</strong> ： 表示 Buffer 最大数据容量，缓冲区容量不能为负，并且创建后不能更改。</li><li><strong>限制 (limit)</strong>： 第一个不应该读取或写入的数据的索引，即位于 limit 后的数据不可读写。缓冲区的限制不能为负，并且不能大于其容量。</li><li><strong>位置 (position)</strong>： 下一个要读取或写入的数据的索引。缓冲区的位置不能为负，并且不能大于其限制。</li><li><strong>标记 (mark)与重置 (reset)</strong>： 标记是一个索引，通过 Buffer 中的 mark() 方法指定 Buffer 中一个特定的 position，之后可以通过调用 reset() 方法恢复到这个 position。</li></ul><p>标记、 位置、 限制、 容量遵守以下不变式： 0 &lt;= mark &lt;= position &lt;= limit &lt;= capacity，可以用下图表示：<br><img src="/2020/01/05/（一）NIO-Buffer/20190331150902388.png" alt="在这里插入图片描述"></p><h2 id="2-2-Buffer-的常用方法"><a href="#2-2-Buffer-的常用方法" class="headerlink" title="2.2 Buffer 的常用方法"></a>2.2 Buffer 的常用方法</h2><p>Buffer 的常用方法及其描述具体如下图所示：<br><img src="/2020/01/05/（一）NIO-Buffer/20190331151008853.png" alt="在这里插入图片描述"><br>Buffer 所有子类提供了两个用于数据操作的方法： get()与 put() 方法。</p><p><strong>获取 Buffer 中的数据</strong>：</p><ul><li>get() ：读取单个字节；</li><li>get(byte[] dst)：批量读取多个字节到 dst 中；</li><li>get(int index)：读取指定索引位置的字节(不会移动 position)。</li></ul><p><strong>放入数据到 Buffer 中：</strong></p><ul><li>put(byte b)：将给定单个字节写入缓冲区的当前位置；</li><li>put(byte[] src)：将 src 中的字节写入缓冲区的当前位置；</li><li>put(int index, byte b)：将指定字节写入缓冲区的索引位置(<strong>不会移动 position</strong>)。<h3 id="2-2-1-示例"><a href="#2-2-1-示例" class="headerlink" title="2.2.1 示例"></a>2.2.1 示例</h3></li></ul><p>1.比如，我们可以先创建一个容量大小为10的缓冲区，然后输出其容量，界限等信息。代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBuffer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//获取指定大小的buffer</span></span><br><span class="line">    ByteBuffer byteBuffer = ByteBuffer.allocate(<span class="number">10</span>);</span><br><span class="line">    </span><br><span class="line">    System.out.println(<span class="string">"------allocate()--------"</span>);</span><br><span class="line">    System.out.println(byteBuffer.capacity());<span class="comment">//10</span></span><br><span class="line">    System.out.println(byteBuffer.position());<span class="comment">//0</span></span><br><span class="line">    System.out.println(byteBuffer.limit());<span class="comment">//10</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>具体图示如下示：<br><img src="/2020/01/05/（一）NIO-Buffer/20190331151638820.png" alt="在这里插入图片描述"><br>2.可以使用put方法向该缓冲区中存储数据，缓冲区的当前位置position会向后移动。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//向缓冲区存入5个数据</span></span><br><span class="line">byteBuffer.put(<span class="string">"abcde"</span>.getBytes());</span><br><span class="line">System.out.println(<span class="string">"------put()--------"</span>);</span><br><span class="line">System.out.println(byteBuffer.capacity());<span class="comment">//10</span></span><br><span class="line">System.out.println(byteBuffer.position());<span class="comment">//5</span></span><br><span class="line">System.out.println(byteBuffer.limit());<span class="comment">//10</span></span><br></pre></td></tr></table></figure><p>存入数据后，缓冲区中的具体图示如下示：<br><img src="/2020/01/05/（一）NIO-Buffer/2019033115192997.png" alt="在这里插入图片描述"><br>3.使用flip方法将缓冲区切换成读模式，具体代码和缓存区变化如下所示：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//切换成读模式</span></span><br><span class="line">System.out.println(<span class="string">"------flip()--------"</span>);</span><br><span class="line">byteBuffer.flip();</span><br><span class="line">System.out.println(byteBuffer.capacity());<span class="comment">//10</span></span><br><span class="line">System.out.println(byteBuffer.position());<span class="comment">//0</span></span><br><span class="line">System.out.println(byteBuffer.limit());<span class="comment">//5</span></span><br></pre></td></tr></table></figure><p><img src="/2020/01/05/（一）NIO-Buffer/20190331152202880.png" alt="在这里插入图片描述"><br>4.接下来我们才可以进行缓冲区中数据的读取操作，这里使用到了get方法。代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//读取数据</span></span><br><span class="line">System.out.println(<span class="string">"------get()--------"</span>);</span><br><span class="line"><span class="comment">//记得是限界以内的数据大小</span></span><br><span class="line"><span class="keyword">byte</span>[] buf = <span class="keyword">new</span> <span class="keyword">byte</span>[byteBuffer.limit()];</span><br><span class="line"><span class="comment">//读取数据到目标数组中</span></span><br><span class="line">byteBuffer.get(buf);</span><br><span class="line">System.out.println(<span class="keyword">new</span> String(buf, <span class="number">0</span>, buf.length));<span class="comment">//abcde</span></span><br><span class="line">System.out.println(byteBuffer.capacity());<span class="comment">//10</span></span><br><span class="line">System.out.println(byteBuffer.position());<span class="comment">//5</span></span><br><span class="line">System.out.println(byteBuffer.limit());<span class="comment">//5</span></span><br></pre></td></tr></table></figure><p>5.当然我们也可以使用rewind方法将position指针重新指向缓冲区0号位处，然后就可以再次进行数据的读取：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//重复读数据</span></span><br><span class="line">System.out.println(<span class="string">"------rewind()--------"</span>);</span><br><span class="line">byteBuffer.rewind();</span><br><span class="line">System.out.println(byteBuffer.capacity());<span class="comment">//10</span></span><br><span class="line">System.out.println(byteBuffer.position());<span class="comment">//0</span></span><br><span class="line">System.out.println(byteBuffer.limit());<span class="comment">//5</span></span><br></pre></td></tr></table></figure><p>6.另外，我们可以使用clear方法清空缓冲区，恢复到缓冲区创建时的初始状态。但是缓冲区中的数据依然存在，但是处于被遗忘状态。所谓被遗忘就是我们无法在确定缓冲区的界限是多少，因此我们便无法自由准确的读取缓冲区中的数据。代码示例如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//清空缓冲区，但是缓冲区中的数据依然存在，但是是处于被遗忘状态</span></span><br><span class="line">System.out.println(<span class="string">"------clear()--------"</span>);</span><br><span class="line">byteBuffer.clear();</span><br><span class="line">System.out.println(byteBuffer.capacity());<span class="comment">//10</span></span><br><span class="line">System.out.println(byteBuffer.position());<span class="comment">//0</span></span><br><span class="line">System.out.println(byteBuffer.limit());<span class="comment">//10</span></span><br><span class="line"><span class="comment">//仍然可以获取缓冲区的数据，但是我们无法确定其界限。</span></span><br><span class="line">System.out.println((<span class="keyword">char</span>)byteBuffer.get(<span class="number">0</span>));<span class="comment">//a</span></span><br></pre></td></tr></table></figure><p>7.最后我们在演示一下mark和reset方法的使用，代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testRemark</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String data = <span class="string">"abcde"</span>;</span><br><span class="line">    <span class="comment">//获取指定大小的buffer</span></span><br><span class="line">    ByteBuffer byteBuffer = ByteBuffer.allocate(<span class="number">10</span>);</span><br><span class="line">    byteBuffer.put(data.getBytes());</span><br><span class="line">    <span class="comment">//标记当前位置</span></span><br><span class="line">    System.out.println(<span class="string">"mark position = "</span> + byteBuffer.position());<span class="comment">//5</span></span><br><span class="line">    byteBuffer.mark();</span><br><span class="line">    <span class="comment">//再次向缓冲区存取数据</span></span><br><span class="line">    byteBuffer.put(<span class="string">"fg"</span>.getBytes());</span><br><span class="line">    System.out.println(<span class="string">"before reset position = "</span> + byteBuffer.position());<span class="comment">//7</span></span><br><span class="line">    <span class="comment">//reset回到mark标记的位置</span></span><br><span class="line">    byteBuffer.reset();</span><br><span class="line">    System.out.println(<span class="string">"after reset position = "</span> + byteBuffer.position());<span class="comment">//5</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="3-直接缓冲区与非直接缓冲区"><a href="#3-直接缓冲区与非直接缓冲区" class="headerlink" title="3. 直接缓冲区与非直接缓冲区"></a>3. 直接缓冲区与非直接缓冲区</h1><p>前面，我们都是使用allocate方法来创建缓冲区的，其所创建的缓冲区为<strong>非直接缓冲区</strong>。该缓冲区是建立在 JVM 的内存中的。</p><p>若使用非直接缓冲区，那么当应用程序向操作系统的磁盘发出一次读写请求时，其过程涉及到内核地址空间和用户地址空间之间数据的来回拷贝操作，这无疑会增加数据的读写的操作时间。具体过程如下图所示：<br><img src="/2020/01/05/（一）NIO-Buffer/20190331154157596.png" alt="在这里插入图片描述"><br>当然，我们也可以使用allocateDirect方法（<strong>注：只有ByteBuffer有提供该方法</strong>）来创建直接缓冲区，直接缓冲区的读写过程如下图所示：<br><img src="/2020/01/05/（一）NIO-Buffer/20190331160053865.png" alt="在这里插入图片描述"><br>它避免了内核地址空间和用户地址空间之间的数据的来回拷贝，而是直接在物理磁盘和应用程序之间建立一个操作系统中的物理内存映射文件。当然，对直接缓冲区进行分配和取消分配所需成本通常高于非直接缓冲区。</p><p>直接缓冲区的内容可以驻留在常规的垃圾回收堆之外，因此，它们对应用程序的内存需求量造成的影响可能并不明显。所以，建议将直接缓冲区主要分配给那些易受基础系统的本机 I/O 操作影响的大型、持久的缓冲区，毕竟直接缓冲区的创建成本比较高。一般情况下，最好仅在直接缓冲区能在程序性能方面带来明显好处时分配它们。</p><p>字节缓冲区是直接缓冲区还是非直接缓冲区可通过调用其 isDirect() 方法来确定。提供此方法是为了能够在性能关键型代码中执行显式缓冲区管理。例如：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBufferType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ByteBuffer allocateDirect = ByteBuffer.allocateDirect(<span class="number">100</span>);</span><br><span class="line">    System.out.println(allocateDirect.isDirect());<span class="comment">//true</span></span><br><span class="line">    </span><br><span class="line">    ByteBuffer byteBuffer = ByteBuffer.allocate(<span class="number">10</span>);</span><br><span class="line">    System.out.println(byteBuffer.isDirect());<span class="comment">//false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div><div><div style="text-align:center;color:#ccc;font-size:24px">------ 本文结束------</div></div></div><div class="post-widgets"><div id="needsharebutton-postbottom"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Java/" rel="tag"><i class="fa fa-tag"></i> Java</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2020/01/05/（十）Java集合框架内幕-WeakHashMap/" rel="next" title="（十）Java集合框架内幕-WeakHashMap"><i class="fa fa-chevron-left"></i> （十）Java集合框架内幕-WeakHashMap</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2020/01/05/（二）NIO-Channel/" rel="prev" title="（二）NIO - Channel">（二）NIO - Channel <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div><div class="comments" id="comments"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-Java-NIO-简介"><span class="nav-text">1. Java NIO 简介</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-使用-Buffer"><span class="nav-text">2. 使用 Buffer</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-Buffer-中的重要概念"><span class="nav-text">2.1 Buffer 中的重要概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-Buffer-的常用方法"><span class="nav-text">2.2 Buffer 的常用方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-1-示例"><span class="nav-text">2.2.1 示例</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-直接缓冲区与非直接缓冲区"><span class="nav-text">3. 直接缓冲区与非直接缓冲区</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/kanieki.png" alt="郑松涛"><p class="site-author-name" itemprop="name">郑松涛</p><div class="site-description" itemprop="description">积跬步，至千里</div></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">280</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">63</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">48</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/ShotoZheng" title="GitHub &rarr; https://github.com/ShotoZheng" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:shotozheng@163.com" title="E-Mail &rarr; mailto:shotozheng@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2023</span> <span class="with-love" id="animate"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">郑松涛</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-area-chart"></i> </span><span title="站点总字数">1.6m</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span title="站点阅读时长">23:55</span></div><div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.9.0</div><span class="post-meta-divider">|</span><div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.4.0</div><div class="busuanzi-count"><script pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="总访客量"><span class="busuanzi-value" id="busuanzi_value_site_uv"></span> </span><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="总访问量"><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span></div></div></footer></div><script src="/lib/anime.min.js?v=3.1.0"></script><script src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script src="/lib/pjax/pjax.min.js?v=0.2.8"></script><script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/jquery/3.6.0/jquery.js"></script><script src="//lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.js"></script><script src="/js/utils.js?v=7.4.0"></script><script src="/js/motion.js?v=7.4.0"></script><script src="/js/schemes/pisces.js?v=7.4.0"></script><script src="/js/next-boot.js?v=7.4.0"></script><script>var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[pjax], script#page-configurations, #pjax script').forEach(element => {
    var id = element.id || '';
    var src = element.src || '';
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (id !=='') {
      script.id = element.id;
    }
    if (src !== '') {
      script.src = src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});</script><script src="/js/local-search.js?v=7.4.0"></script><script pjax>if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme: 'forest',
      logLevel: 3,
      flowchart: { curve: 'linear' },
      gantt: { axisFormat: '%m/%d/%Y' },
      sequence: { actorMargin: 50 }
    });
  }, window.mermaid);
}</script><div id="pjax"><script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-needmoreshare2@1/needsharebutton.min.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Wechat,QQZone,Weibo,Douban,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions)</script><script>NexT.utils.getScript('//cdn.jsdelivr.net/npm/valine/dist/Valine.min.js', () => {
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(item => {
    return GUEST.includes(item);
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: true,
    appId: 'd6TU9yIpopEhNQKUras2D3Nr-gzGzoHsz',
    appKey: 'CJpUierMSXBHmTo6mJ8G1KO1',
    placeholder: 'Just go go',
    avatar: 'monsterid',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false,
    lang: '' || 'zh-cn',
    path: location.pathname
  });
}, window.Valine);</script></div></body></html><script type="text/javascript" src="/js/clicklove.js"></script><script src="/live2d-widget/autoload.js"></script>