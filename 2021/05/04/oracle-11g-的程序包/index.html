<!DOCTYPE html>





<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.4.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.4.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-flash.min.css?v=1.0.2">
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.4.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: true,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="1. 概念程序包是对相关过程、函数、变量、游标和异常等对象的封装。程序包具有模块化、更轻松的应用程序设计、信息隐藏、新增功能和性能更佳等优点。程序包由规范（包头）和主体（包体）两部分组成，及其作用如下图所示：  需要说明的是，包头中声明的变量为公共变量，程序包可以进行访问。而包体中的为私有变量，只能在包体中进行访问。">
<meta name="keywords" content="Oracle">
<meta property="og:type" content="article">
<meta property="og:title" content="oracle 11g 的程序包">
<meta property="og:url" content="https://ShotoZheng.github.io/2021/05/04/oracle-11g-的程序包/index.html">
<meta property="og:site_name" content="鱼肚白不是鱼">
<meta property="og:description" content="1. 概念程序包是对相关过程、函数、变量、游标和异常等对象的封装。程序包具有模块化、更轻松的应用程序设计、信息隐藏、新增功能和性能更佳等优点。程序包由规范（包头）和主体（包体）两部分组成，及其作用如下图所示：  需要说明的是，包头中声明的变量为公共变量，程序包可以进行访问。而包体中的为私有变量，只能在包体中进行访问。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://shotozheng.github.io/2021/05/04/oracle-11g-的程序包/20201107115621459.png">
<meta property="og:updated_time" content="2021-05-04T07:04:40.795Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="oracle 11g 的程序包">
<meta name="twitter:description" content="1. 概念程序包是对相关过程、函数、变量、游标和异常等对象的封装。程序包具有模块化、更轻松的应用程序设计、信息隐藏、新增功能和性能更佳等优点。程序包由规范（包头）和主体（包体）两部分组成，及其作用如下图所示：  需要说明的是，包头中声明的变量为公共变量，程序包可以进行访问。而包体中的为私有变量，只能在包体中进行访问。">
<meta name="twitter:image" content="https://shotozheng.github.io/2021/05/04/oracle-11g-的程序包/20201107115621459.png">
  <link rel="canonical" href="https://ShotoZheng.github.io/2021/05/04/oracle-11g-的程序包/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>oracle 11g 的程序包 | 鱼肚白不是鱼</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  <!--音乐播放器-->
  <link rel="stylesheet" href="/dist/APlayer.min.css">
  <div id="aplayer"></div>
  <script type="text/javascript" src="/dist/APlayer.min.js"></script>
  <script type="text/javascript" src="/dist/music.js"></script>

  <div class="container use-motion">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">鱼肚白不是鱼</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">笨鸟先飞</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-about">
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-categories">
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-网站">
      
    

    <a href="/网站/" rel="section"><i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br>网站</a>

  </li>
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger">
        
          <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
      </li>
    
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
      <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block post">
    <link itemprop="mainEntityOfPage" href="https://ShotoZheng.github.io/2021/05/04/oracle-11g-的程序包/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="郑松涛">
      <meta itemprop="description" content="积跬步，至千里">
      <meta itemprop="image" content="/images/kanieki.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鱼肚白不是鱼">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">oracle 11g 的程序包

          
        </h1>

        <div class="post-meta">

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2021-05-04 15:04:00 / 修改时间：15:04:40" itemprop="dateCreated datePublished" datetime="2021-05-04T15:04:00+08:00">2021-05-04</time>
            </span>
          
            

            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Oracle/" itemprop="url" rel="index"><span itemprop="name">Oracle</span></a></span>

                
                
              
            </span>
          

          
            <span class="post-meta-item" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
        
      
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/05/04/oracle-11g-的程序包/#comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2021/05/04/oracle-11g-的程序包/" itemprop="commentCount"></span></a>
  </span>
  
  
          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">本文字数：</span>
              
              <span>12k</span>
            </span>
          
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              
              <span>11 分钟</span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="1-概念"><a href="#1-概念" class="headerlink" title="1. 概念"></a>1. 概念</h2><p>程序包是对相关过程、函数、变量、游标和异常等对象的封装。程序包具有模块化、更轻松的应用程序设计、信息隐藏、新增功能和性能更佳等优点。程序包由规范（包头）和主体（包体）两部分组成，及其作用如下图所示：</p>
<p><img src="/2021/05/04/oracle-11g-的程序包/20201107115621459.png" alt></p>
<p>需要说明的是，包头中声明的变量为公共变量，程序包可以进行访问。而包体中的为私有变量，只能在包体中进行访问。</p>
<a id="more"></a>

<h2 id="2-创建"><a href="#2-创建" class="headerlink" title="2. 创建"></a>2. 创建</h2><h3 id="2-1-创建语法"><a href="#2-1-创建语法" class="headerlink" title="2.1 创建语法"></a>2.1 创建语法</h3><p>程序包包头创建语法如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> [<span class="keyword">OR</span> <span class="keyword">REPLACE</span>] <span class="keyword">PACKAGE</span> package_name <span class="comment">-- 使用到了package</span></span><br><span class="line"><span class="keyword">IS</span>|<span class="keyword">AS</span></span><br><span class="line">[<span class="keyword">Public</span> item declarations] <span class="comment">-- 公共对象声明</span></span><br><span class="line">[Subprogram specification] <span class="comment">-- 子程序规范</span></span><br><span class="line"><span class="keyword">END</span> [package_name];</span><br></pre></td></tr></table></figure>

<p>程序包包体创建语法如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> [<span class="keyword">OR</span> <span class="keyword">REPLACE</span>] <span class="keyword">PACKAGE</span> <span class="keyword">BODY</span> package_name <span class="comment">-- 使用到了package 和 body</span></span><br><span class="line"><span class="keyword">IS</span>|<span class="keyword">AS</span></span><br><span class="line">[<span class="keyword">Private</span> item declarations] <span class="comment">-- 私有对象声明</span></span><br><span class="line">[Subprogram bodies] <span class="comment">-- 子程序主体</span></span><br><span class="line">[<span class="keyword">BEGIN</span> Initialization]</span><br><span class="line"><span class="keyword">END</span> [package_name];</span><br></pre></td></tr></table></figure>

<h3 id="2-2-示例"><a href="#2-2-示例" class="headerlink" title="2.2 示例"></a>2.2 示例</h3><p>假设现在有如下 student 表，具体内容如下所示：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; select * from student;</span><br><span class="line"></span><br><span class="line">                                    SNO SNAME                                         SAGE</span><br><span class="line"><span class="comment">--------------------------------------- ---------- ---------------------------------------</span></span><br><span class="line">                                      5 lisi                                            -6</span><br><span class="line">                                      1 Tom                                             31</span><br><span class="line">                                      2 Kite                                            32</span><br><span class="line">                                      3 Bob                                             33</span><br><span class="line">                                      4 Mike                                            34</span><br></pre></td></tr></table></figure>

<p>首先创建如下程序包包头：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> <span class="keyword">replace</span> <span class="keyword">package</span> pack1</span><br><span class="line"><span class="keyword">is</span></span><br><span class="line">    aa <span class="built_in">int</span> := <span class="number">-9</span>; <span class="comment">-- 公共变量</span></span><br><span class="line">    procedure insert_student(a1 in student%rowtype); <span class="comment">-- 声明一个存储过程</span></span><br><span class="line">    procedure update_student(a2 in student%rowtype); <span class="comment">-- 声明一个存储过程</span></span><br><span class="line"><span class="keyword">end</span> pack1;</span><br><span class="line">/</span><br></pre></td></tr></table></figure>

<p>接着创建对应的包体：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> <span class="keyword">replace</span> <span class="keyword">package</span> <span class="keyword">body</span> pack1 <span class="comment">-- 增加一个 body 且名字相对应</span></span><br><span class="line"><span class="keyword">is</span></span><br><span class="line">    bb <span class="built_in">int</span> := <span class="number">5</span>; <span class="comment">-- 声明一个私有变量</span></span><br><span class="line">    <span class="comment">-- 定义第一个存储过程</span></span><br><span class="line">    procedure insert_student(a1 in student%rowtype)</span><br><span class="line">    is</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">insert</span> <span class="keyword">into</span> student(sno, sname, sage) <span class="keyword">values</span> (a1.sno, a1.sname, a1.sage);</span><br><span class="line">    	<span class="keyword">commit</span>;</span><br><span class="line">    	<span class="comment">-- 验证一下私有变量</span></span><br><span class="line">    	dbms_output.put_line(pack1.bb);</span><br><span class="line">    <span class="keyword">end</span> insert_student;</span><br><span class="line">    <span class="comment">-- 定义第二个存储过程</span></span><br><span class="line">    procedure update_student(a2 in student%rowtype)</span><br><span class="line">    is</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">update</span> student <span class="keyword">set</span> sname = a2.sname, sage = a2.sage <span class="keyword">where</span> sno = a2.sno;</span><br><span class="line">    	<span class="keyword">commit</span>;</span><br><span class="line">    <span class="keyword">end</span> update_student;</span><br><span class="line"><span class="keyword">end</span> pack1;</span><br><span class="line">/</span><br></pre></td></tr></table></figure>

<p>我们来验证一下公有变量和私有变量得访问限制，查看下面输出结果，包体中的公共变量可以在程序包访问。而包体中的私有变量则不可以：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; execute dbms_output.put_line(pack1.aa);</span><br><span class="line"></span><br><span class="line">-9</span><br><span class="line"></span><br><span class="line"><span class="comment">------------------------------------------</span></span><br><span class="line"></span><br><span class="line">SQL&gt; execute dbms_output.put_line(pack1.bb);</span><br><span class="line"><span class="keyword">begin</span> dbms_output.put_line(pack1.bb); <span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line">ORA-06550: 第 1 行, 第 34 列: </span><br><span class="line">PLS-00302: 必须声明 'BB' 组件</span><br><span class="line">ORA-06550: 第 1 行, 第 7 列: </span><br><span class="line">PL/SQL: Statement ignored</span><br></pre></td></tr></table></figure>

<p>同样也可以调用程序包中定义的存储过程，具体如下所示：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span></span><br><span class="line">    stu student%rowtype;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    stu.sno := <span class="number">7</span>;</span><br><span class="line">    stu.sname := '张章';</span><br><span class="line">    stu.sage := 42;</span><br><span class="line">    <span class="comment">-- 调用程序包</span></span><br><span class="line">    pack1.insert_student(stu);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line">/</span><br><span class="line"><span class="comment">-- 执行上述 PL/SQL 块之后，student 多了一条相应的记录</span></span><br><span class="line">SQL&gt; select * from student;</span><br><span class="line"></span><br><span class="line">                                    SNO SNAME                                         SAGE</span><br><span class="line"><span class="comment">--------------------------------------- ---------- ---------------------------------------</span></span><br><span class="line">                                      7 张章                                            42</span><br><span class="line">                                      5 lisi                                            -6</span><br><span class="line">                                      1 Tom                                             31</span><br><span class="line">                                      2 Kite                                            32</span><br><span class="line">                                      3 Bob                                             33</span><br><span class="line">                                      4 Mike                                            34</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span></span><br><span class="line">    stu student%rowtype;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    stu.sno := <span class="number">5</span>;</span><br><span class="line">    stu.sname := 'zhangsan';</span><br><span class="line">    stu.sage := 12;</span><br><span class="line">    <span class="comment">-- 调用程序包</span></span><br><span class="line">    pack1.update_student(stu);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line">/</span><br><span class="line"><span class="comment">-- 同理如下</span></span><br><span class="line">SQL&gt; select * from student;</span><br><span class="line"></span><br><span class="line">                                    SNO SNAME                                         SAGE</span><br><span class="line"><span class="comment">--------------------------------------- ---------- ---------------------------------------</span></span><br><span class="line">                                      7 张章                                            42</span><br><span class="line">                                      5 zhangsan                                        12</span><br><span class="line">                                      1 Tom                                             31</span><br><span class="line">                                      2 Kite                                            32</span><br><span class="line">                                      3 Bob                                             33</span><br><span class="line">                                      4 Mike                                            34</span><br></pre></td></tr></table></figure>

<h2 id="3-程序包中的游标"><a href="#3-程序包中的游标" class="headerlink" title="3. 程序包中的游标"></a>3. 程序包中的游标</h2><p>程序包中使用游标与我们平常在 PL/SQL 块中游标的方式不太一样。在程序包中，游标的定义分为游标规范和游标主体两部分。在包规范中声明游标规范时必须使用 RETURN 子句<strong>指定游标的返回类型</strong>，RETURN子句指定的数据类型可以是：</p>
<ul>
<li>用 %ROWTYPE 属性引用表定义的记录类型</li>
<li>自定义的记录类型，例如 TYPE EMPRECTYP IS RECORD(emp_id INTEGER,salary REAL)来定义的。</li>
</ul>
<p>但是不可以是 number，varchar2， %TYPE等类型。 </p>
<p>下面我们介绍在程序包中使用显式游标，示例如下所示：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建包头</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">PACKAGE</span> cur_pack</span><br><span class="line"><span class="keyword">IS</span></span><br><span class="line">    <span class="keyword">CURSOR</span> stu_cur(stu_num <span class="built_in">number</span>) <span class="keyword">RETURN</span> student%rowtype; <span class="comment">-- 游标规范部分，需要带上 return 子句</span></span><br><span class="line">    PROCEDURE print_stu(stu_num number);</span><br><span class="line"><span class="keyword">end</span> cur_pack;</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建包体</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">PACKAGE</span> <span class="keyword">BODY</span> cur_pack</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line">    <span class="comment">-- 记得参数名称需要与包头的对应上</span></span><br><span class="line">    <span class="keyword">CURSOR</span> stu_cur(stu_num <span class="built_in">number</span>) <span class="keyword">RETURN</span> student%ROWTYPE <span class="keyword">IS</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> sno = stu_num; <span class="comment">-- 游标主体部分</span></span><br><span class="line">    <span class="comment">-- 存储过程主体部分</span></span><br><span class="line"> 	PROCEDURE print_stu(stu_num number) </span><br><span class="line"> 	IS</span><br><span class="line"> 		stu student%ROWTYPE; <span class="comment">-- 声明变量</span></span><br><span class="line"> 		<span class="keyword">BEGIN</span></span><br><span class="line">  		<span class="keyword">OPEN</span> stu_cur(stu_num);  <span class="comment">-- 打开游标</span></span><br><span class="line">  		LOOP</span><br><span class="line">    		FETCH stu_cur INTO stu; <span class="comment">-- 游标记录当前行记录</span></span><br><span class="line">    		EXIT WHEN stu_cur%NOTFOUND;</span><br><span class="line">    		DBMS_OUTPUT.PUT_LIne('当前学生信息：学号=' || stu.sno || ',姓名=' || stu.sname || ', 年龄=' || stu.sage);</span><br><span class="line">  		<span class="keyword">END</span> <span class="keyword">LOOP</span>;</span><br><span class="line">  		CLOSE stu_cur; <span class="comment">-- 关闭游标</span></span><br><span class="line"> 	<span class="keyword">END</span> print_stu;</span><br><span class="line"><span class="keyword">END</span> cur_pack;</span><br><span class="line">/</span><br></pre></td></tr></table></figure>

<p>使用如下语句调用如上的程序包，结果如下所示：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; exec cur_pack.print_stu(2);</span><br><span class="line"></span><br><span class="line">当前学生信息：学号=2,姓名=Kite, 年龄=32</span><br><span class="line"></span><br><span class="line">PL/SQL procedure successfully completed</span><br></pre></td></tr></table></figure>

<p>下面我们介绍在程序包中使用 REF 游标，示例如下所示：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建包头</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> <span class="keyword">replace</span> <span class="keyword">package</span> pack_ref <span class="keyword">is</span></span><br><span class="line">    <span class="keyword">type</span> refcur <span class="keyword">is</span> <span class="keyword">ref</span> <span class="keyword">cursor</span>; <span class="comment">-- 此处只声明类型为参照游标的类型变量</span></span><br><span class="line">    procedure mycursor_use; <span class="comment">-- 声明存储过程</span></span><br><span class="line"><span class="keyword">end</span> pack_ref;</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建包体</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> <span class="keyword">replace</span> <span class="keyword">package</span> <span class="keyword">body</span> pack_ref <span class="keyword">is</span></span><br><span class="line"><span class="keyword">procedure</span> mycursor_use <span class="keyword">is</span></span><br><span class="line">    mycursor refcur; <span class="comment">-- 此处声明类型为 refcur 的变量</span></span><br><span class="line">    stu_rec student%rowtype;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">open</span> mycursor <span class="keyword">for</span> <span class="keyword">select</span> * <span class="keyword">from</span> student;</span><br><span class="line">    LOOP</span><br><span class="line">        fetch mycursor into stu_rec;</span><br><span class="line">        EXIT WHEN mycursor%NOTFOUND;</span><br><span class="line">        DBMS_OUTPUT.put_line('学号：' || stu_rec.sno || '，姓名：' || stu_rec.sname);</span><br><span class="line">    <span class="keyword">END</span> <span class="keyword">LOOP</span>;</span><br><span class="line">    close mycursor;</span><br><span class="line"><span class="keyword">end</span> mycursor_use;</span><br><span class="line"><span class="keyword">end</span> pack_ref;</span><br><span class="line">/</span><br></pre></td></tr></table></figure>

<p>使用如下语句调用如上的程序包，结果如下所示：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; exec pack_ref.mycursor_use();</span><br><span class="line"></span><br><span class="line">学号：7，姓名：张章</span><br><span class="line">学号：5，姓名：zhangsan</span><br><span class="line">学号：1，姓名：Tom</span><br><span class="line">学号：2，姓名：Kite</span><br><span class="line">学号：3，姓名：Bob</span><br><span class="line">学号：4，姓名：Mike</span><br><span class="line"></span><br><span class="line">PL/SQL procedure successfully completed</span><br></pre></td></tr></table></figure>

<h2 id="4-子程序和程序包的信息"><a href="#4-子程序和程序包的信息" class="headerlink" title="4. 子程序和程序包的信息"></a>4. 子程序和程序包的信息</h2><p><strong>USER_OBJECTS 视图包含用户创建的子程序和程序包的信息，通过如下语句查询：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> object_name, object_type</span><br><span class="line"><span class="keyword">FROM</span> USER_OBJECTS</span><br><span class="line"><span class="keyword">WHERE</span> object_type <span class="keyword">IN</span> (<span class="string">'PROCEDURE'</span>, <span class="string">'FUNCTION'</span>, <span class="string">'PACKAGE'</span>, <span class="string">'PACKAGE BODY'</span>);</span><br></pre></td></tr></table></figure>

<p>查询结果如下所示：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">OBJECT_NAME                                                                      OBJECT_TYPE</span><br><span class="line"><span class="comment">-------------------------------------------------------------------------------- -------------------</span></span><br><span class="line">PROC_OUT                                                                         PROCEDURE</span><br><span class="line">FIND_EMP                                                                         PROCEDURE</span><br><span class="line">PROC_EXCHANGE                                                                    PROCEDURE</span><br><span class="line">FUN_HELLO                                                                        FUNCTION</span><br><span class="line">STUD_RANKING                                                                     FUNCTION</span><br><span class="line">PACK1                                                                            PACKAGE BODY</span><br><span class="line">PACK1                                                                            PACKAGE</span><br><span class="line">CUR_PACK                                                                         PACKAGE BODY</span><br><span class="line">CUR_PACK                                                                         PACKAGE</span><br><span class="line">PACK_REF                                                                         PACKAGE</span><br><span class="line">PACK_REF                                                                         PACKAGE BODY</span><br></pre></td></tr></table></figure>

<p><strong>USER_SOURCE 视图存储子程序和程序包的源代码，通过如下语句查询：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">text</span> <span class="keyword">FROM</span> USER_SOURCE <span class="keyword">WHERE</span> <span class="keyword">NAME</span>=<span class="string">'PACK_REF'</span>;     <span class="comment">---注意大写</span></span><br></pre></td></tr></table></figure>

<p>查询结果如下所示：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; SELECT text FROM USER_SOURCE WHERE NAME='PACK_REF';     ---注意大写</span><br><span class="line"></span><br><span class="line">TEXT</span><br><span class="line"><span class="comment">--------------------------------------------------------------------------------</span></span><br><span class="line">package pack_ref is</span><br><span class="line">    type refcur is ref cursor; <span class="comment">-- 此处只声明类型为参照游标的类型变量</span></span><br><span class="line">    procedure mycursor_use; <span class="comment">-- 声明存储过程</span></span><br><span class="line"><span class="keyword">end</span> pack_ref;</span><br><span class="line">package body pack_ref is</span><br><span class="line">procedure mycursor_use is</span><br><span class="line">    mycursor refcur; <span class="comment">-- 此处声明类型为 refcur 的变量</span></span><br><span class="line">    stu_rec student%rowtype;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">open</span> mycursor <span class="keyword">for</span> <span class="keyword">select</span> * <span class="keyword">from</span> student;</span><br><span class="line">    LOOP</span><br><span class="line">        fetch mycursor into stu_rec;</span><br><span class="line">        EXIT WHEN mycursor%NOTFOUND;</span><br><span class="line">        DBMS_OUTPUT.put_line('学号：' || stu_rec.sno || '，姓名：' || stu_rec.sname);</span><br><span class="line">    <span class="keyword">END</span> <span class="keyword">LOOP</span>;</span><br><span class="line">    close mycursor;</span><br><span class="line"><span class="keyword">end</span> mycursor_use;</span><br><span class="line"><span class="keyword">end</span> pack_ref;</span><br></pre></td></tr></table></figure>

<h2 id="5-内置程序包"><a href="#5-内置程序包" class="headerlink" title="5. 内置程序包"></a>5. 内置程序包</h2><p>oracle 内置有一些内置程序包，常用如下：</p>
<table>
<thead>
<tr>
<th><strong>程序包名称</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>STANDARD和DBMS_STANDARD</td>
<td>定义和扩展PL/SQL语言环境</td>
</tr>
<tr>
<td>DBMS_LOB</td>
<td>提供对 LOB数据类型进行操作的功能</td>
</tr>
<tr>
<td>DBMS_OUTPUT</td>
<td>处理PL/SQL块和子程序输出调试信息</td>
</tr>
<tr>
<td>DBMS_RANDOM</td>
<td>提供随机数生成器</td>
</tr>
<tr>
<td>DBMS_SQL</td>
<td>允许用户使用动态 SQL</td>
</tr>
<tr>
<td>DBMS_XMLDOM</td>
<td>用DOM模型读写XML类型的数据</td>
</tr>
<tr>
<td>DBMS_XMLPARSER</td>
<td>XML解析，处理XML文档内容和结构</td>
</tr>
<tr>
<td>DBMS_XMLQUERY</td>
<td>提供将数据转换为 XML 类型的功能</td>
</tr>
<tr>
<td>DBMS_XSLPROCESSOR</td>
<td>提供XSLT功能，转换XML文档</td>
</tr>
<tr>
<td>UTL_FILE</td>
<td>用 PL/SQL 程序来读写操作系统文本文件</td>
</tr>
</tbody></table>
<h3 id="5-1-DBMS-OUTPUT"><a href="#5-1-DBMS-OUTPUT" class="headerlink" title="5.1 DBMS_OUTPUT"></a>5.1 DBMS_OUTPUT</h3><p>该程序可以直接向控制台打印输出调试信息，类似于 Java 中的 <code>System.out.println(&quot;xxxx&quot;);</code>语句，这里不再过多说明。</p>
<h3 id="5-2-DBMS-RANDOM"><a href="#5-2-DBMS-RANDOM" class="headerlink" title="5.2 DBMS_RANDOM"></a>5.2 DBMS_RANDOM</h3><p>DBMS_RANDOM 包可用来生成随机整数。</p>
<p>示例1：</p>
<blockquote>
<p>产生随机数</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; SET SERVEROUTPUT ON</span><br><span class="line">SQL&gt; DECLARE</span><br><span class="line">   l_num   NUMBER;</span><br><span class="line">   counter NUMBER;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">   counter:=<span class="number">1</span>;</span><br><span class="line">   WHILE counter &lt;= 10</span><br><span class="line">   LOOP</span><br><span class="line">     l_num := DBMS_RANDOM.RANDOM;</span><br><span class="line">     DBMS_OUTPUT.PUT_LINE(l_num);</span><br><span class="line">     counter:=counter+1;</span><br><span class="line">   <span class="keyword">END</span> <span class="keyword">LOOP</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line">/</span><br><span class="line"><span class="comment">-- 输出结果</span></span><br><span class="line">-1844779820</span><br><span class="line">2090599204</span><br><span class="line">46142221</span><br><span class="line">1419758385</span><br><span class="line">-1286235225</span><br><span class="line">-2065024678</span><br><span class="line">-1259274836</span><br><span class="line">-57157868</span><br><span class="line">1933458772</span><br><span class="line">-1037520283</span><br></pre></td></tr></table></figure>

<p>示例2：</p>
<blockquote>
<p>产生一个100以内的随机正整数</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ABS</span>(<span class="keyword">MOD</span>(DBMS_RANDOM.RANDOM,<span class="number">100</span>)) <span class="keyword">FROM</span> DUAL;</span><br></pre></td></tr></table></figure>

<p>示例3：</p>
<blockquote>
<p>使用VALUE函数返回一个大于等于0但是小于1的数</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> DBMS_RANDOM.VALUE <span class="keyword">FROM</span> DUAL;</span><br></pre></td></tr></table></figure>

<p>示例4：</p>
<blockquote>
<p>返回 [0, 100) 之间的值</p>
</blockquote>
<p>对于指定范围内的整数，要加入参数low_value和high_value，并从结果中截取小数（最大值<strong>不能</strong>被作为可能的值）。所以对于0到99之间的小数，可以使用下面的代码 ：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  DBMS_RANDOM.VALUE(<span class="number">0</span>, <span class="number">100</span>)  <span class="keyword">FROM</span>  DUAL;  <span class="comment">-- 返回区间内的小数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> TRUNC(DBMS_RANDOM.VALUE(<span class="number">0</span>, <span class="number">100</span>)) <span class="keyword">FROM</span>  DUAL; <span class="comment">-- 返回区间内的整数</span></span><br></pre></td></tr></table></figure>

<p>示例5：</p>
<blockquote>
<p>产生随机序列</p>
</blockquote>
<p>STRING函数生成随机文本字符串，可以指定字符串的类型和所希望的长度：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> DBMS_RANDOM.STRING(<span class="string">'A'</span>, <span class="number">20</span>) rand_seq <span class="keyword">FROM</span> DUAL;  <span class="comment">-- 生成长度为 20 的大小写混合的字符序列</span></span><br></pre></td></tr></table></figure>

<p>第一个参数存在如下类型的代码：</p>
<p>‘U’用来生成大写字符，‘L’用来生成小写字符，‘A’用来生成大小写混合的字符，’P’ 表示 字符串由任意可打印字符构成， ’X’ 表示字符串由大写字符和数字构成。</p>
<p>输出结果示例如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; SELECT DBMS_RANDOM.STRING('A', 20) rand_seq FROM DUAL;  -- 生成长度为 20 的大小写混合的字符序列</span><br><span class="line"></span><br><span class="line">RAND_SEQ</span><br><span class="line"><span class="comment">--------------------------------------------------------------------------------</span></span><br><span class="line">iFvSXfHZMfNYIfffXDlo</span><br></pre></td></tr></table></figure>

<h3 id="5-3-UTL-FILE"><a href="#5-3-UTL-FILE" class="headerlink" title="5.3 UTL_FILE"></a>5.3 UTL_FILE</h3><p>UTL_FILE 包可用于读写操作系统文本文件，操作文件的一般过程是打开、读或写、关闭。UTL_FILE 包指定文件路径依赖于 DIRECTORY 对象。</p>
<p>首先需要登录管理员用户创建 DIRECTORY 对象，然后将该对象的读写权限授予指定用户，示例如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; CREATE DIRECTORY TEST_DIR AS 'F:\TEST';</span><br><span class="line">SQL&gt; GRANT READ, WRITE ON DIRECTORY TEST_DIR TO SCOTT;</span><br></pre></td></tr></table></figure>

<p>接下来我们就可以使用 SCOTT 用户来使用 UTL_FILE 来操作文件，使用示例如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">  input_file   UTL_FILE.FILE_TYPE; <span class="comment">-- 声明文件类型</span></span><br><span class="line">  input_buffer VARCHAR2(4000);</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  input_file := UTL_FILE.FOPEN(<span class="string">'TEST_DIR'</span>, <span class="string">'demo.txt'</span>, <span class="string">'r'</span>); <span class="comment">-- 以读的方式打开 TEST_DIR 目录对象下的 demo.txt 文件</span></span><br><span class="line">  LOOP</span><br><span class="line">    UTL_FILE.GET_LINE(input_file, input_buffer); <span class="comment">-- 每次读取一行</span></span><br><span class="line">    DBMS_OUTPUT.PUT_LINE(input_buffer);</span><br><span class="line">  <span class="keyword">END</span> <span class="keyword">LOOP</span>;</span><br><span class="line">  UTL_FILE.FCLOSE(input_file); <span class="comment">-- 关闭文件</span></span><br><span class="line">EXCEPTION</span><br><span class="line">  WHEN NO_DATA_FOUND THEN</span><br><span class="line">    DBMS_OUTPUT.PUT_LINE('<span class="comment">------------------'); -- 读取到没有数据时打印</span></span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line">/</span><br></pre></td></tr></table></figure>

<h3 id="5-4-DBMS-JOB"><a href="#5-4-DBMS-JOB" class="headerlink" title="5.4 DBMS_JOB"></a>5.4 DBMS_JOB</h3><p> DBMS_JOB 可以创建定时任务调度程序，下面我们就简单的来使用 DBMS_JOB 程序包，关于更多的使用方法可以查阅官方文档。</p>
<ol>
<li>首先创建测试表：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> a(a <span class="built_in">date</span>);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>创建一个自定义过程：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> <span class="keyword">replace</span> <span class="keyword">procedure</span> <span class="keyword">test</span> <span class="keyword">as</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">insert</span> <span class="keyword">into</span> a <span class="keyword">values</span>(<span class="keyword">sysdate</span>);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line">/</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>创建一个定时任务 JOB：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">variable job1 number;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="comment">-- test; 表示调用的存储过程（需要分号），并将调用的结果返回给 job1 变量, : 指明 job1 是一个变量</span></span><br><span class="line">    <span class="comment">-- sysdate 参数是表示什么时候提交这个 job，这里我们使用当前时间</span></span><br><span class="line">    <span class="comment">-- 最后一个参数表示每天1440分钟，即一分钟运行test过程一次</span></span><br><span class="line">    dbms_job.submit(:job1,<span class="string">'test;'</span>, <span class="keyword">sysdate</span>, <span class="string">'sysdate + 1 / 1440'</span>);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line">/</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>运行 job：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">begin</span></span><br><span class="line">    dbms_job.run(:job1);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line">/</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>检查结果，每隔一分钟 a 表就会插入一条记录：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; select to_char(a,'yyyy/mm/dd hh24:mi:ss') 时间 from a;</span><br><span class="line"></span><br><span class="line">时间</span><br><span class="line"><span class="comment">-------------------</span></span><br><span class="line">2020/11/07 11:37:45</span><br><span class="line">2020/11/07 11:38:45</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>删除JOB：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">begin</span></span><br><span class="line">    dbms_job.remove(:job1);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line">/</span><br></pre></td></tr></table></figure>
    </div>

    
    
    

    <div>
    
    <div>
    
        <div style="text-align:center;color: #ccc;font-size:24px;">------ 本文结束------</div>
    
</div>

    
    </div>
        
      

      <footer class="post-footer">
          
            
          
          <div class="post-tags">
            
              <a href="/tags/Oracle/" rel="tag"><i class="fa fa-tag"></i> Oracle</a>
            
          </div>
        

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/2021/05/04/oracle-11g-的触发器/" rel="next" title="oracle 11g 的触发器">
                  <i class="fa fa-chevron-left"></i> oracle 11g 的触发器
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/2021/05/04/Java-访问-oracle-11g-中的存储过程/" rel="prev" title="Java 访问 oracle 11g 中的存储过程">
                  Java 访问 oracle 11g 中的存储过程 <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        
      </footer>
    
  </div>
  
  
  
  </article>

  </div>


          </div>
          
    
    <div class="comments" id="comments"></div>
  

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">
        
        
        
        
      

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-概念"><span class="nav-text">1. 概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-创建"><span class="nav-text">2. 创建</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-创建语法"><span class="nav-text">2.1 创建语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-示例"><span class="nav-text">2.2 示例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-程序包中的游标"><span class="nav-text">3. 程序包中的游标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-子程序和程序包的信息"><span class="nav-text">4. 子程序和程序包的信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-内置程序包"><span class="nav-text">5. 内置程序包</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-DBMS-OUTPUT"><span class="nav-text">5.1 DBMS_OUTPUT</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-DBMS-RANDOM"><span class="nav-text">5.2 DBMS_RANDOM</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-UTL-FILE"><span class="nav-text">5.3 UTL_FILE</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4-DBMS-JOB"><span class="nav-text">5.4 DBMS_JOB</span></a></li></ol></li></ol></div>
        
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="/images/kanieki.png"
      alt="郑松涛">
  <p class="site-author-name" itemprop="name">郑松涛</p>
  <div class="site-description" itemprop="description">积跬步，至千里</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">147</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        <span class="site-state-item-count">46</span>
        <span class="site-state-item-name">分类</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        <span class="site-state-item-count">30</span>
        <span class="site-state-item-name">标签</span>
        </a>
      </div>
    
  </nav>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://github.com/ShotoZheng" title="GitHub &rarr; https://github.com/ShotoZheng" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="mailto:shotozheng@163.com" title="E-Mail &rarr; mailto:shotozheng@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
    
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">郑松涛</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">821k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">12:27</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.9.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.4.0</div>
        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="总访客量">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  
    <span class="post-meta-divider">|</span>
  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="总访问量">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>












        
      </div>
    </footer>
  </div>

  


  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
<script src="/js/utils.js?v=7.4.0"></script><script src="/js/motion.js?v=7.4.0"></script>
<script src="/js/schemes/pisces.js?v=7.4.0"></script>
<script src="/js/next-boot.js?v=7.4.0"></script>



  








  <script src="/js/local-search.js?v=7.4.0"></script>










<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme: 'forest',
      logLevel: 3,
      flowchart: { curve: 'linear' },
      gantt: { axisFormat: '%m/%d/%Y' },
      sequence: { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>




  

  

  

  


<script>
NexT.utils.getScript('//cdn.jsdelivr.net/npm/valine/dist/Valine.min.js', () => {
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(item => {
    return GUEST.includes(item);
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: false,
    appId: 'd6TU9yIpopEhNQKUras2D3Nr-gzGzoHsz',
    appKey: 'CJpUierMSXBHmTo6mJ8G1KO1',
    placeholder: 'Just go go',
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false,
    lang: '' || 'zh-cn',
    path: location.pathname
  });
}, window.Valine);
</script>

</body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/clicklove.js"></script>
<!--看板娘-->
<script src="/live2d-widget/autoload.js"></script>
